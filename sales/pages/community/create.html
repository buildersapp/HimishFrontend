<html>
    <?php include('includes/head.php'); ?>
    <body class="bg-gray-50 font-sans">
        <div id="main-container" class="flex h-screen">
            <?php include('includes/sidebar.php'); ?>
            <main id="main-content" class="flex-1 overflow-auto">
                <?php include('includes/nav-header.php'); ?>

                <!-- Create Community Content -->
                <div id="create-community-content" class="p-8">
                    <div class="max-w-2xl">
                        <div id="community-form" class="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">Community Details</h3>
                                <p class="text-gray-600"><?= isset($_GET['id']) ? 'Update' : 'Create a new' ?> community to invite users and earn commissions from their ads</p>
                            </div>

                            <form class="space-y-6" method="post" data-parsley-validate id="createCommunityForm" enctype="multipart/form-data" onsubmit="return validateCreateCommunity($(this));">
                                <!-- Community ID (hidden) -->
                                <input type="hidden" name="id" value="<?= $commID ?>" />

                                <!-- Community Name (Required) -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Community Name <span class="text-red-500">*</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        name="community_name"
                                        id="community_name" 
                                        placeholder="Enter community name" 
                                        required 
                                        data-parsley-required-message="Community name is required"
                                        value="<?= htmlspecialchars(@$commData['name'], ENT_QUOTES) ?>"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-transparent" 
                                    />
                                </div>

                                <!-- Description -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea
                                        name="description"
                                        rows="4"
                                        placeholder="Describe your community and what it's about..."
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-transparent resize-none"
                                    ><?= htmlspecialchars(@$commData['description'], ENT_QUOTES) ?></textarea>
                                </div>

                                <!-- Community Type -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Community Type</label>
                                    <input type="hidden" name="is_private" id="is_private" value="<?= @$commData['is_private'] ?>">
                                    
                                    <div class="grid grid-cols-2 gap-4" id="community-type-options">
                                        <!-- Public -->
                                        <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" title="Anyone can find and join">
                                            <input type="radio" name="community_type" value="public" class="sr-only" <?= @$commData['is_private'] == '0' ? 'checked' : '' ?> />
                                            <div class="flex items-center space-x-3 w-full">
                                                <div class="radio-indicator w-4 h-4 border-2 border-blue-600 rounded-full flex items-center justify-center">
                                                    <div class="dot w-2 h-2 bg-blue-600 rounded-full <?= @$commData['is_private'] == '0' ? '' : 'hidden' ?>"></div>
                                                </div>
                                                <div>
                                                    <div class="flex items-center space-x-2">
                                                        <i class="fa-solid fa-globe text-green-600"></i>
                                                        <span class="font-medium text-gray-900">Public</span>
                                                    </div>
                                                    <p class="text-gray-500 text-sm">Anyone can find and join</p>
                                                </div>
                                            </div>
                                        </label>

                                        <!-- Private -->
                                        <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" title="Invite-only community">
                                            <input type="radio" name="community_type" value="private" class="sr-only" <?= @$commData['is_private'] == '1' ? 'checked' : '' ?> />
                                            <div class="flex items-center space-x-3 w-full">
                                                <div class="radio-indicator w-4 h-4 border-2 border-pink-300 rounded-full flex items-center justify-center">
                                                    <div class="dot w-2 h-2 bg-pink-300 rounded-full <?= @$commData['is_private'] == '1' ? '' : 'hidden' ?>"></div>
                                                </div>
                                                <div>
                                                    <div class="flex items-center space-x-2">
                                                        <i class="fa-solid fa-lock text-orange-600"></i>
                                                        <span class="font-medium text-gray-900">Private</span>
                                                    </div>
                                                    <p class="text-gray-500 text-sm">Invite-only community</p>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Community Image -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Community Image</label>
                                    <div 
                                        class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors cursor-pointer"
                                        onclick="document.getElementById('community-file').click();"
                                    >
                                        <i class="fa-solid fa-cloud-upload-alt text-gray-400 text-3xl mb-3"></i>
                                        <p class="text-gray-600 mb-2">Click to upload or drag and drop</p>
                                        <p class="text-gray-400 text-sm">PNG, JPG, MP4 up to 5MB</p>
                                        <input 
                                            type="file" 
                                            id="community-file" 
                                            accept="image/*,video/*" 
                                            class="hidden" 
                                            onchange="previewMedia(event,'community')" 
                                        />
                                    </div>

                                    <!-- Previews -->
                                    <div class="mt-4">
                                        <img id="community-img" src="<?= @$commData['image'] ? MEDIA_BASE_URL.$commData['image'] : '' ?>" class="<?= @$commData['image'] ? '' : 'hidden' ?> max-h-40 rounded-lg border" />
                                        <div id="community-video-container" class="hidden">
                                            <video id="community-video" controls class="max-h-40 rounded-lg border"></video>
                                        </div>
                                        <input type="hidden" id="community-cropped" name="community_cropped" />
                                        <div id="community-text" class="text-sm text-gray-500 mt-2"></div>
                                    </div>
                                </div>

                                <!-- Location -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                    <div class="relative">
                                        <i class="fa-solid fa-map-marker-alt absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                        <input 
                                            type="text" 
                                            name="address" 
                                            placeholder="Enter community location (optional)" 
                                            value="<?= htmlspecialchars($commData['address'] ?? '', ENT_QUOTES) ?>"
                                            class="address-autocomplete w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-transparent" 
                                        />
                                        <input type="hidden" name="latitude" id="latitude" value="<?= $commData['latitude'] ?>">
                                        <input type="hidden" name="longitude" id="longitude" value="<?= $commData['longitude'] ?>">
                                        <input type="hidden" name="city" id="city" value="<?= $commData['city'] ?>">
                                        <input type="hidden" name="state" id="state" value="<?= $commData['state'] ?>">
                                        <input type="hidden" name="country_code" id="country_code" value="<?= $commData['country_code'] ?>">
                                    </div>
                                </div>

                                <!-- Submit -->
                                <button 
                                    type="submit" 
                                    name="addCommunity"
                                    id="create-community-btn" 
                                    class="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-purple-700 transition-colors">
                                    <?= isset($_GET['id']) ? 'Update' : 'Create' ?> Community
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </body>
    <?php include('includes/footer-scripts.php'); ?>
    <script src="assets/js/communities.js?v=<?= time() ?>"></script>
</html>
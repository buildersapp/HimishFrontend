<!DOCTYPE html>
<html lang="en">
    <?php include('includes/head.php') ?>
    <!-- Include RateIt CSS & JS -->
    <body>
        <?php include('includes/nav-header.php') ?>
        <main>
            <!-- ************************************ -->
            <!-- HERO SECTION  -->
            <!-- ************************************ --> 
            <section class="set-hero-sec">
                <div class="set-bg-illustration">
                    <div class="container">
                    <div class="row">
                        <div class="col-lg-8 mx-auto">
                        <div class="text-center">
                            <h1 class="f-48-w m-0">Find What You Need. Post What You Offer</h1>
                            <div class="row">
                            <div class="col-lg-7 mx-auto">
                                <p class="f-16-w mt-20">Discover local services, listings, and communitiesâ€” all in one platform.</p>
                                <div class="d-flex align-items-center gap-3 mt-20">
                                <?php if (!empty($userDetails)) { ?>
                                        <!-- <> -->
                                            <a href="create-post.php" type="button" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                title="Create a Post about your business." class="set-btn-primary set-onhover-primary gap-2 d-flex align-items-center justify-content-center text-white" data-bs-toggle="modal" data-bs-target="#setMultiStepModal">
                                                <svg width="13" height="12" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M5.66797 6.83366H0.667969V5.16699H5.66797V0.166992H7.33464V5.16699H12.3346V6.83366H7.33464V11.8337H5.66797V6.83366Z" fill="white"/></svg>Create Post
                                                </a>
                                        <!-- </a> -->
                                    <?php } else { ?>
                                        <button type="button" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Create a Post about your business." onclick="guestLoginModal()" class="set-btn-primary set-onhover-primary gap-2 d-flex align-items-center justify-content-center"><svg width="13" height="12" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M5.66797 6.83366H0.667969V5.16699H5.66797V0.166992H7.33464V5.16699H12.3346V6.83366H7.33464V11.8337H5.66797V6.83366Z" fill="white"/>
                                            </svg>Create Post
                                        </button>
                                    <?php } ?>
                                <a href="companies.php" class="set-btn-primary-outline text-decoration-none text-white">Company</a>
                                </div>
                            </div>
                            </div>
                            
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
            </section>
            <section class="dashboard">
                <div class="container">
                    <div class="row" id="dashboard-row">
                        

                        <!-- content tab  -->
                        <div class="col-lg-12 mt-0">
                            <div class="main-content">
                                <h3 class="set-company-tile-unique">Companies</h3>
                                <!-- SEARCH -->
                            <div class="col-lg-8 col-md-8 col-12">
                                <!-- <div class="input-group set-custom-search">
                                    <input type="text" class="form-control" placeholder="Search anything...">
                                    <button type="submit" class="input-group-text"><img src="assets/images/search-icon-outline.png" alt="search"></button>
                                </div> -->
                            </div>
                                <div class="posts-feed">
                                    <!-- Company Filter Section -->
                                    <div class="company-filter-container">
                                        <!-- Left Arrow (outside slick slider) -->
                                        <button class="slick-arrow-left custom-arrow">&#8592;</button>

                                        <!-- Slick Slider -->
                                        <div class="company-filter">
                                            <button class="company-filter-btn <?= $product_service_id === 0 ? 'active' : '' ?>" data-filter="">All</button>
                                            <?php foreach ($filters as $filter): ?>
                                                <button class="company-filter-btn <?= $product_service_id == $filter['id'] ? 'active' : '' ?>" data-filter="<?= $filter['id'] ?>">
                                                    <?= htmlspecialchars($filter['name']) ?>
                                                </button>
                                            <?php endforeach; ?>
                                        </div>

                                        <!-- Right Arrow (outside slick slider) -->
                                        <button class="slick-arrow-right custom-arrow">&#8594;</button>
                                    </div>

                                    
                                    <!-- Company Listings -->
                                    <div class="row">
                                        <!-- user profile  -->
                                        <?php include('pages/home/left-panel.html') ?>
                                        <div class="col-lg-6">
                                            <div class="search mt-3">
                                                <div action="" class="navSearch set-custom-search" style="position: relative;">
                                                    <input type="text" name="search" class="form-control comp-search-inp" placeholder="Search..." autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="company-listings row gx-3" id="companies-container">
                                        
                                            </div>
                                        </div>
                                        <!-- Sponsored Posts Section -->
                                        <?php include('pages/home/right-panel.html') ?>
                                    </div>
                                    
                                    <?php if($companyId > 0){ ?>
                                        <button type="button" onclick="removeIdAndReload()" class="mt-3 upload-buttom-top sk-gradint-button-one">
                                            Load All Companies
                                            <img src="assets/img/Arrow Forward.svg" alt="Arrow" />
                                        </button>
                                    <?php } ?>
                                </div>
                            </div>
                        </div>
    
                        
                    </div>
                </div>
            </section>
        </main>
    </body>
    <?php include('includes/footer-scripts.php') ?>
    <script src="assets/js/companies.js?v=<?= time() ?>"></script>
    <script src="assets/js/home.js?v=<?= time() ?>"></script>
    <script>
        let companiesData = {
            type: '<?= $type ?>',
            radius: '<?= $radius ?>',
            search: '<?= $search ?>',
            user_id: 0,
            company_id: '<?= $companyId ?>',
            category_id: 0,
            product_service_id: '<?= $product_service_id ?>',
        };

    // Initial Fetch on Page Load
    $(document).ready(function () {
        getCompanies(companiesData); // Load initial posts with the default data
        enableScrollPagination(companiesData, "#companies-container"); // Enable infinite scroll

        <?php if (empty(@$userDetails['location'])): ?>
                const ifGuestLogin = localStorage.getItem('gu_change_location');
                if (!ifGuestLogin) {
                    getUserLocation();
                }else{
                    let city = localStorage.getItem('userCity');
                    let state = localStorage.getItem('userState');
                    document.querySelector(".nav-location span").innerText = `${city}, ${state}`;
                }
        <?php endif; ?>

        // Watch for changes in the search input
        $(".comp-search-inp").on("input", function () {
            companiesData.search = $(this).val();
            companiesData.page = 1;
            getCompanies(companiesData);
        });

    });

    $(document).ready(function () {
        const $slider = $('.company-filter');

        $slider.slick({
            slidesToShow: 5,
            slidesToScroll: 5,
            arrows: false,
            infinite: false,
            swipeToSlide: true,
            variableWidth: true
        });

        $('.slick-arrow-left').on('click', function () {
            $slider.slick('slickPrev');
        });

        $('.slick-arrow-right').on('click', function () {
            $slider.slick('slickNext');
        });
    });
    </script>
</html>
